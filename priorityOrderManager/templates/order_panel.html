{% extends "base.html" %}
{% block content %}
<div class="card shadow-sm">
  <div class="card-body position-relative">
    <h2 class="card-title fw-bold text-primary d-flex align-items-center">
      <i class="bi bi-card-list me-2 text-warning"></i> SipariÅŸ Paneli
    </h2>
    <p class="text-muted mb-4">
      Bu panelde kuyruktaki sipariÅŸleri,bekleme sÃ¼relerini,iÅŸlem durumlarÄ±nÄ± ve Ã¼rÃ¼n bilgilerini gÃ¶zlemleyebilirsiniz.
      <span class="badge bg-warning text-dark">â˜… Premium</span> mÃ¼ÅŸteriler daha yÃ¼ksek baz Ã¶ncelik skoruyla baÅŸlar. Bekleme sÃ¼resi (<span class="text-secondary">â³</span>) arttÄ±kÃ§a dinamik Ã¶ncelik (<span class="text-danger">âš¡</span>) yÃ¼kselir.
      Arka planda Ã§oklu threadâ€™ler ve semafor (aynÄ± anda en fazla 2 sipariÅŸ) kullanÄ±larak iÅŸlem yapÄ±lÄ±r. Bu sayede bazÄ± sipariÅŸler kuyrukta bekler, bekleme sÃ¼resi artar ve premium mÃ¼ÅŸteriler avantajlÄ± duruma gelir.
    </p>
    <div class="table-responsive position-relative">
      <div class="refresh-indicator"></div>
      <table class="table align-middle table-hover" id="orderTable">
          <thead class="table-dark">
              <tr>
                  <th scope="col">SipariÅŸ ID</th>
                  <th scope="col">MÃ¼ÅŸteri ID</th>
                  <th scope="col">MÃ¼ÅŸteri TÃ¼rÃ¼</th>
                  <th scope="col">ÃœrÃ¼n ID</th>
                  <th scope="col">Miktar</th>
                  <th scope="col" data-bs-toggle="tooltip" title="Bekleme SÃ¼resi (â³): SipariÅŸin kuyrukta kaldÄ±ÄŸÄ± sÃ¼re">â³ Bekleme SÃ¼resi (sn)</th>
                  <th scope="col" data-bs-toggle="tooltip" title="Dinamik Ã–ncelik (âš¡): Baz Skor + (Bek.SÃ¼resiÃ—0.5)">âš¡ Ã–ncelik</th>
                  <th scope="col">Durum</th>
              </tr>
          </thead>
          <tbody class="fade-in-rows">
          {% for o in orders %}
          <tr class="order-row {% if o.CustomerType == 'Premium' %}premium-row{% endif %}">
              <td>{{ o.OrderID }}</td>
              <td>{{ o.CustomerID }}</td>
              <td>
                {% if o.CustomerType == 'Premium' %}
                  <span class="badge bg-warning text-dark">â˜… Premium</span>
                {% else %}
                  Standart
                {% endif %}
              </td>
              <td>ğŸ“¦ {{ o.ProductID }}</td>
              <td>{{ o.Quantity }}</td>
              <td class="wait-time" style="--wait-time: {{o.WaitTime}};">{{ o.WaitTime }}</td>
              <td class="priority-cell" style="--priority: {{o.DynamicPriority}};">
                {{ o.DynamicPriority }}
                {% if o.DynamicPriority > 20 %}
                <i class="bi bi-lightning-charge-fill text-danger priority-flash"></i>
                {% else %}
                <i class="bi bi-lightning-charge-fill text-warning"></i>
                {% endif %}
              </td>
              <td>
                {% if o.Status == 'Approved' %}
                  <span class="text-success fw-bold">âœ”ï¸ OnaylandÄ±</span>
                {% elif o.Status == 'Rejected' %}
                  <span class="text-danger fw-bold">âŒ Reddedildi</span>
                {% else %}
                  <span class="text-secondary">Beklemede</span>
                {% endif %}
              </td>
          </tr>
          {% endfor %}
          </tbody>
      </table>
    </div>
    <small class="text-muted">
      Tablo her 3 saniyede bir otomatik yenilenir.
    </small>

  </div>
</div>
<script src="{{ url_for('static', filename='js/order_update.js') }}"></script>
<script>
$(document).ready(function(){
  var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
  var tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
      return new bootstrap.Tooltip(tooltipTriggerEl)
  })
});
</script>
{% endblock %}
